<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.collections.FXCollections?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.control.ScrollPane?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="ui.HomeController"
            prefWidth="1400.0" prefHeight="900.0"
            styleClass="root-pane">

    <!-- HEADER -->
    <top>
        <VBox styleClass="header-container">
            <StackPane styleClass="header-bar">
                <children>
                    <!-- Background HBox για τα κουμπιά -->
                    <HBox spacing="0" alignment="CENTER_LEFT">
                        <children>
                            <!-- Αριστερά: Κουμπιά -->
                            <HBox alignment="CENTER_LEFT" HBox.hgrow="NEVER" spacing="12">
                                <children>
                                    <!-- Κουμπί Προεπισκοπήσεις Αλλαγών (για όλους) - Coming soon -->
                                    <Button text="Προεπισκοπήσεις Αλλαγών" onAction="#onNavigateProjections" styleClass="auth-button" fx:id="projectionsButton"/>
                                </children>
                                <padding>
                                    <Insets top="0" right="0" bottom="0" left="32"/>
                                </padding>
                            </HBox>
                            
                            <Region HBox.hgrow="ALWAYS"/>
                            
                            <!-- Κουμπί Σύνδεση/Αποσύνδεση δεξιά -->
                            <HBox alignment="CENTER_RIGHT" HBox.hgrow="NEVER">
                                <children>
                                    <Button fx:id="authButton" onAction="#onAuthButtonClicked" styleClass="auth-button"/>
                                </children>
                                <padding>
                                    <Insets top="0" right="32" bottom="0" left="0"/>
                                </padding>
                            </HBox>
                        </children>
                    </HBox>
                    
                    <!-- Logo centered -->
                    <VBox spacing="0" alignment="CENTER" StackPane.alignment="CENTER" mouseTransparent="true">
                        <children>
                            <Region prefHeight="15.0" mouseTransparent="true"/>
                            <ImageView fx:id="headerLogoImageView" mouseTransparent="true">
                                <image>
                                    <Image url="@/images/logo.png"/>
                                </image>
                                <fitWidth>300.0</fitWidth>
                                <preserveRatio>true</preserveRatio>
                            </ImageView>
                            <Region prefHeight="25.0" mouseTransparent="true"/>
                        </children>
                    </VBox>
                </children>
            </StackPane>
        </VBox>
    </top>

    <!-- CENTER CONTENT -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="content-scroll">
            <content>
                <VBox spacing="24" styleClass="content-container">
                    <padding>
                        <Insets top="24" right="32" bottom="24" left="32"/>
                    </padding>
                    <children>
                        
                        <!-- HOME VIEW (Summary Cards) -->
                        <VBox fx:id="homeView" spacing="32" alignment="TOP_CENTER">
                            <children>
                                <!-- YEAR SELECTION DROPDOWN -->
                                <HBox spacing="12" alignment="CENTER" styleClass="year-buttons-container">
                                    <children>
                                        <ComboBox fx:id="yearComboBox" onAction="#onYearSelected" styleClass="year-combo-box" prefWidth="170.0" prefHeight="50" minHeight="50" maxHeight="50"/>
                                        <Button fx:id="homeEditButton" onAction="#onNavigateDataManagement" styleClass="auth-button" visible="false" managed="false" prefWidth="170.0" prefHeight="50" minHeight="50" maxHeight="50">
                                            <graphic>
                                                <HBox spacing="6" alignment="CENTER">
                                                    <Label text="Επεξεργασία" style="-fx-font-size: 15px; -fx-font-weight: 600; -fx-text-fill: #1e40af;"/>
                                                    <Label text="✎" style="-fx-font-size: 20px; -fx-text-fill: #1e40af; -fx-rotate: -8;"/>
                                                </HBox>
                                            </graphic>
                                        </Button>
                                    </children>
                                </HBox>


                                <!-- SUMMARY CARDS -->
                                <HBox styleClass="summary-row" spacing="24" alignment="CENTER">
                                    <children>
                                        <VBox styleClass="summary-card" spacing="8">
                                            <children>
                                                <Label text="Συνολικά Έσοδα" styleClass="summary-label"/>
                                                <Label fx:id="totalRevenuesLabel" text="€100,2 δισ." styleClass="summary-number"/>
                                                <Label fx:id="revenuesDeltaLabel" text="+2,3% από πέρυσι" styleClass="summary-delta positive"/>
                                            </children>
                                        </VBox>

                                        <VBox styleClass="summary-card" spacing="8">
                                            <children>
                                                <Label text="Συνολικές Δαπάνες" styleClass="summary-label"/>
                                                <Label fx:id="totalExpensesLabel" text="€98,5 δισ." styleClass="summary-number"/>
                                                <Label fx:id="expensesDeltaLabel" text="+1,1% από πέρυσι" styleClass="summary-delta positive"/>
                                            </children>
                                        </VBox>

                                        <VBox styleClass="summary-card" spacing="8">
                                            <children>
                                                <Label text="Ισοζύγιο" styleClass="summary-label"/>
                                                <Label fx:id="balanceLabel" text="+€1,7 δισ." styleClass="summary-number"/>
                                                <Label fx:id="balanceStatusLabel" text="Πλεόνασμα" styleClass="summary-delta positive"/>
                                            </children>
                                        </VBox>
                                    </children>
                                </HBox>

                                <!-- QUICK NAVIGATION CARDS -->
                                <VBox spacing="16">
                                    <children>
                                        <HBox spacing="20" alignment="CENTER" styleClass="quick-nav-row">
                                            <children>
                                                <VBox styleClass="quick-nav-card" spacing="12" fx:id="quickNavMinistries" alignment="CENTER">
                                                    <children>
                                                        <Label text="1" styleClass="quick-nav-number"/>
                                                        <Label text="Υπουργεία &amp; Φορείς" styleClass="quick-nav-title"/>
                                                        <Label text="Ανάλυση δαπανών ανά υπουργείο" styleClass="quick-nav-description"/>
                                                        <Label text="Δείτε περισσότερα →" styleClass="quick-nav-link"/>
                                                    </children>
                                                </VBox>

                                                <VBox styleClass="quick-nav-card" spacing="12" fx:id="quickNavRevenues" alignment="CENTER">
                                                    <children>
                                                        <Label text="2" styleClass="quick-nav-number"/>
                                                        <Label text="Έσοδα" styleClass="quick-nav-title"/>
                                                        <Label text="Κατανομή των εσόδων ανά είδος" styleClass="quick-nav-description"/>
                                                        <Label text="Δείτε περισσότερα →" styleClass="quick-nav-link"/>
                                                    </children>
                                                </VBox>

                                                <VBox styleClass="quick-nav-card" spacing="12" fx:id="quickNavExpenses" alignment="CENTER">
                                                    <children>
                                                        <Label text="3" styleClass="quick-nav-number"/>
                                                        <Label text="Δαπάνες" styleClass="quick-nav-title"/>
                                                        <Label text="Κατανομή των δαπανών ανά είδος" styleClass="quick-nav-description"/>
                                                        <Label text="Δείτε περισσότερα →" styleClass="quick-nav-link"/>
                                                    </children>
                                                </VBox>

                                                <VBox styleClass="quick-nav-card" spacing="12" fx:id="quickNavAdministrations" alignment="CENTER">
                                                    <children>
                                                        <Label text="4" styleClass="quick-nav-number"/>
                                                        <Label text="Αποκεντρωμένες Διοικήσεις" styleClass="quick-nav-title"/>
                                                        <Label text="Γεωγραφική κατανομή των δαπανών" styleClass="quick-nav-description"/>
                                                        <Label text="Δείτε περισσότερα →" styleClass="quick-nav-link"/>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>

                            </children>
                        </VBox>

                        <!-- MINISTRIES VIEW -->
                        <VBox fx:id="ministriesView" spacing="16" visible="false" managed="false">
                            <children>
                                <VBox spacing="12" alignment="CENTER_LEFT">
                                    <children>
                                        <HBox spacing="16" alignment="CENTER_LEFT">
                                            <children>
                                                <Button text="← Αρχική" onAction="#onNavigateHome" styleClass="back-button"/>
                                                <Label text="Υπουργεία &amp; Φορείς" styleClass="section-title"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                                <VBox styleClass="section-card" spacing="16">
                                    <padding>
                                        <Insets top="24" right="24" bottom="24" left="24"/>
                                    </padding>
                                    <children>
                                        <TableView fx:id="categoryTable" prefHeight="600">
                                            <columns>
                                                <TableColumn fx:id="categoryColumn" text="Υπουργείο / Φορέας" prefWidth="400"/>
                                                <TableColumn fx:id="amountColumn" text="Δαπάνες (€)" prefWidth="220"/>
                                                <TableColumn fx:id="percentageColumn" text="Συμμετοχή (%)" prefWidth="180"/>
                                                <TableColumn fx:id="changeColumn" text="Μεταβολή από προηγούμενο έτος" prefWidth="250"/>
                                            </columns>
                                        </TableView>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                        <!-- REVENUES VIEW -->
                        <VBox fx:id="revenuesView" spacing="16" visible="false" managed="false">
                            <children>
                                <VBox spacing="12" alignment="CENTER_LEFT">
                                    <children>
                                        <HBox spacing="16" alignment="CENTER_LEFT">
                                            <children>
                                                <Button text="← Αρχική" onAction="#onNavigateHome" styleClass="back-button"/>
                                                <Label text="Έσοδα" styleClass="section-title"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                                <VBox styleClass="section-card" spacing="16">
                                    <padding>
                                        <Insets top="24" right="24" bottom="24" left="24"/>
                                    </padding>
                                    <children>
                                        <TableView fx:id="revenuesTable" prefHeight="600">
                                            <columns>
                                                <TableColumn fx:id="revenueCategoryColumn" text="Είδος Έσοδων" prefWidth="450"/>
                                                <TableColumn fx:id="revenueAmountColumn" text="Ποσό (€)" prefWidth="280"/>
                                                <TableColumn fx:id="revenuePercentageColumn" text="Συμμετοχή (%)" prefWidth="220"/>
                                            </columns>
                                        </TableView>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                        <!-- EXPENSES VIEW -->
                        <VBox fx:id="expensesView" spacing="16" visible="false" managed="false">
                            <children>
                                <VBox spacing="12" alignment="CENTER_LEFT">
                                    <children>
                                        <HBox spacing="16" alignment="CENTER_LEFT">
                                            <children>
                                                <Button text="← Αρχική" onAction="#onNavigateHome" styleClass="back-button"/>
                                                <Label text="Δαπάνες" styleClass="section-title"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                                <VBox styleClass="section-card" spacing="16">
                                    <padding>
                                        <Insets top="24" right="24" bottom="24" left="24"/>
                                    </padding>
                                    <children>
                                        <TableView fx:id="expensesTable" prefHeight="600">
                                            <columns>
                                                <TableColumn fx:id="expenseCategoryColumn" text="Είδος Δαπανών" prefWidth="450"/>
                                                <TableColumn fx:id="expenseAmountColumn" text="Ποσό (€)" prefWidth="280"/>
                                                <TableColumn fx:id="expensePercentageColumn" text="Συμμετοχή (%)" prefWidth="220"/>
                                            </columns>
                                        </TableView>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                        <!-- ADMINISTRATIONS VIEW -->
                        <VBox fx:id="administrationsView" spacing="16" visible="false" managed="false">
                            <children>
                                <VBox spacing="12" alignment="CENTER_LEFT">
                                    <children>
                                        <HBox spacing="16" alignment="CENTER_LEFT">
                                            <children>
                                                <Button text="← Αρχική" onAction="#onNavigateHome" styleClass="back-button"/>
                                                <Label text="Αποκεντρωμένες Διοικήσεις" styleClass="section-title"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                                <VBox styleClass="section-card" spacing="16">
                                    <padding>
                                        <Insets top="24" right="24" bottom="24" left="24"/>
                                    </padding>
                                    <children>
                                        <TableView fx:id="administrationsTable" prefHeight="600">
                                            <columns>
                                                <TableColumn fx:id="adminCategoryColumn" text="Αποκεντρωμένη Διοίκηση" prefWidth="550"/>
                                                <TableColumn fx:id="adminAmountColumn" text="Ποσό (€)" prefWidth="280"/>
                                                <TableColumn fx:id="adminPercentageColumn" text="Συμμετοχή (%)" prefWidth="220"/>
                                            </columns>
                                        </TableView>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                        <!-- DATA MANAGEMENT VIEW (Government Only) -->
                        <VBox fx:id="dataManagementView" spacing="24" alignment="TOP_CENTER" visible="false" managed="false">
                            <children>
                                <!-- Back Button -->
                                <HBox spacing="12" alignment="CENTER_LEFT" styleClass="section-card">
                                    <padding>
                                        <Insets top="12" right="24" bottom="12" left="24"/>
                                    </padding>
                                    <children>
                                        <Button text="← Επιστροφή στην Αρχική" onAction="#onNavigateHome" styleClass="auth-button" prefWidth="200" prefHeight="35"/>
                                    </children>
                                </HBox>
                                
                                <!-- Year Selection -->
                                <StackPane styleClass="section-card">
                                    <padding>
                                        <Insets top="20" right="24" bottom="20" left="24"/>
                                    </padding>
                                    <children>
                                        <!-- Background HBox for left content -->
                                        <HBox spacing="12" alignment="CENTER_LEFT">
                                            <children>
                                                <ComboBox fx:id="dataManagementYearComboBox" prefWidth="120" prefHeight="35" onAction="#onDataManagementYearSelected" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-background-color: #f3f4f6; -fx-border-color: #1e40af; -fx-border-width: 2px; -fx-border-radius: 5px;"/>
                                            </children>
                                        </HBox>
                                        
                                        <!-- Centered title -->
                                        <Label fx:id="dataManagementYearTitleLabel" text="Διαχείριση Δεδομένων Έτους 2026" styleClass="section-title" StackPane.alignment="CENTER" mouseTransparent="true"/>
                                    </children>
                                </StackPane>
                                
                                <!-- Statistics Summary Card -->
                                <VBox spacing="12" styleClass="section-card">
                                    <padding>
                                        <Insets top="20" right="24" bottom="20" left="24"/>
                                    </padding>
                                    <children>
                                        <Label text="Σύνοψη Προϋπολογισμού" styleClass="section-title"/>
                                        <HBox spacing="32" alignment="CENTER_LEFT">
                                            <children>
                                                <VBox spacing="4">
                                                    <Label text="Συνολικά Έσοδα" styleClass="section-subtitle"/>
                                                    <Label fx:id="dmTotalRevenuesLabel" text="0 €" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #059669;"/>
                                                </VBox>
                                                <VBox spacing="4">
                                                    <Label text="Συνολικές Δαπάνες" styleClass="section-subtitle"/>
                                                    <Label fx:id="dmTotalExpensesLabel" text="0 €" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #dc2626;"/>
                                                </VBox>
                                                <VBox spacing="4">
                                                    <Label text="Υπόλοιπο" styleClass="section-subtitle"/>
                                                    <Label fx:id="dmBalanceLabel" text="0 €" style="-fx-font-size: 20px; -fx-font-weight: bold;"/>
                                                </VBox>
                                                <VBox spacing="4">
                                                    <Label text="Αλλαγή από Προηγούμενο Έτος" styleClass="section-subtitle"/>
                                                    <Label fx:id="dmYearChangeLabel" text="0%" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                                </VBox>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                                
                                <!-- Main Data Table Card -->
                                <VBox spacing="16" styleClass="section-card">
                                    <padding>
                                        <Insets top="24" right="24" bottom="24" left="24"/>
                                    </padding>
                                    <children>
                                        <HBox spacing="12" alignment="CENTER_LEFT">
                                            <children>
                                                <Region HBox.hgrow="ALWAYS"/>
                                                <Button text="+ Προσθήκη" onAction="#onAddData" styleClass="primary-button"/>
                                                <Button text="Εισαγωγή από Αρχείο" onAction="#onImportData" styleClass="button"/>
                                                <Button text="Εξαγωγή" onAction="#onExportData" styleClass="button"/>
                                            </children>
                                        </HBox>
                                        
                                        <!-- Search and Filter Bar -->
                                        <HBox spacing="12" alignment="CENTER_LEFT">
                                            <children>
                                                <TextField fx:id="dmSearchField" promptText="Αναζήτηση..." prefWidth="250" onKeyReleased="#onSearchData"/>
                                                <ComboBox fx:id="dmTypeFilter" promptText="Όλοι οι τύποι" prefWidth="150" onAction="#onFilterData"/>
                                                <Button text="Καθαρισμός Φίλτρων" onAction="#onClearFilters" styleClass="button"/>
                                                <Region HBox.hgrow="ALWAYS"/>
                                                <Label fx:id="dmRecordCountLabel" text="0 εγγραφές" styleClass="section-subtitle"/>
                                            </children>
                                        </HBox>
                                        
                                        <TableView fx:id="dataManagementTable" prefHeight="450">
                                            <columns>
                                                <TableColumn fx:id="dmCategoryColumn" text="Κατηγορία" prefWidth="250" sortable="true"/>
                                                <TableColumn fx:id="dmAmountColumn" text="Ποσό (€)" prefWidth="150" sortable="true"/>
                                                <TableColumn fx:id="dmPercentageColumn" text="Συμμετοχή (%)" prefWidth="120" sortable="true"/>
                                                <TableColumn fx:id="dmTypeColumn" text="Τύπος" prefWidth="150" sortable="true"/>
                                                <TableColumn fx:id="dmChangeColumn" text="Αλλαγή από Προηγ. Έτος" prefWidth="150" sortable="true"/>
                                                <TableColumn fx:id="dmStatusColumn" text="Κατάσταση" prefWidth="120" sortable="true"/>
                                            </columns>
                                        </TableView>
                                        
                                        <HBox spacing="12" alignment="CENTER_LEFT">
                                            <children>
                                                <Button text="Επεξεργασία" onAction="#onEditData" styleClass="button" fx:id="editDataButton" disable="true"/>
                                                <Button text="Διαγραφή" onAction="#onDeleteData" styleClass="button" fx:id="deleteDataButton" disable="true"/>
                                                <Button text="Μαζική Επεξεργασία" onAction="#onBulkEdit" styleClass="button" fx:id="bulkEditButton" disable="true"/>
                                                <Region HBox.hgrow="ALWAYS"/>
                                                <Button text="Επιλογή Όλων" onAction="#onSelectAll" styleClass="button"/>
                                                <Button text="Αποεπιλογή Όλων" onAction="#onDeselectAll" styleClass="button"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                                
                                <VBox spacing="16" styleClass="section-card">
                                    <padding>
                                        <Insets top="24" right="24" bottom="24" left="24"/>
                                    </padding>
                                    <children>
                                        <Label text="Εσωτερικά Σχόλια" styleClass="section-title"/>
                                        <Label text="Προσθέστε σχόλια και σημειώσεις για τα δεδομένα (ορατά μόνο στην κυβέρνηση)" styleClass="section-subtitle"/>
                                        <TextArea fx:id="internalCommentsArea" prefRowCount="6" wrapText="true" promptText="Εισάγετε εσωτερικά σχόλια..."/>
                                        <HBox spacing="12" alignment="CENTER_RIGHT">
                                            <children>
                                                <Button text="Αποθήκευση Σχολίων" onAction="#onSaveComments" styleClass="primary-button"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                    </children>
                </VBox>
            </content>
        </ScrollPane>
    </center>

    <!-- FOOTER -->
    <bottom>
        <HBox styleClass="footer-bar" spacing="16">
            <padding>
                <Insets top="12" right="32" bottom="12" left="32"/>
            </padding>
            <children>
                <Label text="eProipologismos v0.0.1" styleClass="footer-text"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="© 2025 - Ομάδα Ανάπτυξης" styleClass="footer-text"/>
                <Label text="|" styleClass="footer-separator"/>
                <Label text="Τεκμηρίωση" styleClass="footer-link"/>
            </children>
        </HBox>
    </bottom>

</BorderPane>